
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Python and pyserial on a WRT54G router - M.G.</title>
  <meta name="author" content="Gábor Molnár">

  
  <meta name="description" content="I’ve been trying to install python with serial support on a WRT54G router running openwrt for a day, and now it’s done :) The problem was that the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://gabor.molnar.es/blog/2010/05/29/python-and-pyserial-on-wrt54g-router">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="M.G." type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Open+Sans&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
<!--<link href='//fonts.googleapis.com/css?family=Fjalla+One&subset=latin-ext,latin' rel='stylesheet' type='text/css'>-->
<link href='//fonts.googleapis.com/css?family=Oswald:700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1277369-13']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">M.G.</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:gabor.molnar.es" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Python and pyserial on a WRT54G router</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-29T22:38:00+02:00" pubdate data-updated="true">May 29<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><!-- more -->

<p>I’ve been trying to install python with serial support on a WRT54G router running openwrt for a day, and now it’s done :)</p>

<p>The problem was that the router has only 4Mb of flash memory, and the whole operating system must fit into this space. The openwrt distribution itself is about 3Mb, without python installed. The python package is 2Mb, and it occupies 4Mb or more when installed.</p>

<p>The first solution is that you expand the storage capacity of your router by attaching an SD-card to it. You can do this easily, <a href="http://www.yourwarrantyisvoid.com/2009/09/09/add-an-sd-card-slot-to-a-wrt54g-v2/">this guide</a> will help, and there is a lot of other tutorials out there.</p>

<p>But if you want to do it without soldering, or buying anything, there is an another solution: I’ve made a custom openwrt image. I wanted the router to connect to a  wireless network, but I didn’t need the access point functionality, so I’ve cut it out, and used python-mini instead of python. The created image file was only 3.2Mb.</p>

<p>First of all, you have to use linux to do this. If you don’t have one installed, you could use an Ubuntu LiveCD, or an other Linux LiveCD.</p>

<p>The first step is to download the openwrt ImageBuilder. I suggest using the newest openwrt release, which is at the time of writing Backfire, for which the ImageBuilder can be downloaded <a href="http://wiki.openwrt.org/doc/howto/obtain.firmware.generate">from here</a>.</p>

<p>After unpacking it, I used the following command to build the images:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>make image <span class="nv">PROFILE</span><span class="o">=</span><span class="s2">&quot;Broadcom-b43&quot;</span> <span class="nv">PACKAGES</span><span class="o">=</span><span class="s2">&quot;-dnsmasq -e2fsprogs -kmod-fs-ext3 -kmod-ppp -kmod-pppoe -kmod-scsi-core -kmod-usb-core -kmod-usb-ohci -kmod-usb-storage -kmod-usb2 -ppp -ppp-mod-pppoe -iptables -iptables-mod-conntrack -iptables-mod-nat -kmod-ipt-conntrack -kmod-ipt-core -kmod-ipt-nat -kmod-ipt-nathelper -firewall -mtd -nvram python-mini pyserial&quot;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>As you can see, a lot of things were cut out, like ext3, usb, scsi, ppp, and iptables support, but python-mini and pyserial were included.</p>

<p>After installation, python runs fine, but if you want to import the serial module, it won’t load, because the termios module is missing from the python-mini. So what now? The first thing I found that the <a href="https://dev.openwrt.org/ticket/6897">problem was reported</a> to the developers of openwrt. After a while, I found a blog post which describes a solution for the problem. The author of the post built the openwrt python package from source, and copied the termios.so file to the device.</p>

<p>I didnt want to compile it, because it seemed difficult (at least I didnt want to read another 5 howto about building openwrt packages from source). So here is what I did:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>cp packages/python_2.6.4-3_brcm47xx.ipk /tmp/
</span><span class="line"><span class="nv">$ </span><span class="nb">cd</span> /tmp
</span><span class="line"><span class="nv">$ </span>mv  python_2.6.4-3_brcm47xx.ipk python.tar.gz
</span><span class="line"><span class="nv">$ </span>tar -xvzf python.tar.gz
</span><span class="line"><span class="nv">$ </span>tar -xvzf data.tar.gz
</span><span class="line"><span class="nv">$ </span><span class="nb">cd</span> ./usr/lib/python2.6/lib-dynload/
</span><span class="line"><span class="nv">$ </span>scp termios.so root@192.168.1.1:/usr/lib/python2.6/
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>As you can see, the ipk package is just a tar.gz, and you can extract the termios.so easily. After extracting, put int in the /usr/lib/python2.6 directory on the router.</p>

<p>I hope this post saves you from using google more than you would want :)</p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Gábor Molnár</span></span>

      








  


<time datetime="2010-05-29T22:38:00+02:00" pubdate data-updated="true">May 29<span>th</span>, 2010</time>
      


    </p>
    
      <div class="sharing">
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2008/08/25/ubuntu-es-debian-tavoli-elerese-ssh-val/" title="Previous Post: Ubuntu és Debian távoli elérése SSH-val">&laquo; Ubuntu és Debian távoli elérése SSH-val</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/05/05/javascript-programozas-jegyzet-fuggvenyek/" title="Next Post: JavaScript programozás - Függvények">JavaScript programozás - Függvények &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <!--<h1>Comments</h1>-->
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/13/ucsb-ictf-2013-uranus/">UCSB iCTF 2013 - The Uranus service</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/25/gsoc-wrap-up/">GSoC - wrap up</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/15/gsoc-week-number-13/">GSoC week #13</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/09/gsoc-week-number-12/">GSoC week #12</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/03/gsoc-week-number-11/">GSoC week #11</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Gábor Molnár -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'gabor-molnar';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://gabor.molnar.es/blog/2010/05/29/python-and-pyserial-on-wrt54g-router/';
        var disqus_url = 'http://gabor.molnar.es/blog/2010/05/29/python-and-pyserial-on-wrt54g-router/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>







</body>
</html>
